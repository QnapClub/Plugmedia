(function(a){var b=0;a.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:"",hide:"",autoOpen:false,multiple:true,position:{}},_create:function(){var l=this.element,h=this.options,e=[],k=[],i=l.attr("title"),j=l.id||b++;this.speed=a.fx.speeds._default;this._isOpen=false;e.push('<button type="button" class="ui-multiselect ui-widget ui-state-default ui-corner-all');h.classes.length&&e.push(" "+h.classes);e.push('"');i.length&&e.push(' title="'+i+'"');e.push('><span class="ui-icon ui-icon-triangle-2-n-s"></span><span>'+h.noneSelectedText+"</span></button>");e.push('<div class="ui-multiselect-menu ui-widget ui-widget-content ui-corner-all '+(h.classes.length?h.classes:"")+'">');e.push('<div class="ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix">');e.push('<ul class="ui-helper-reset">');if(h.header===true&&h.multiple){e.push('<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+h.checkAllText+"</span></a></li>");e.push('<li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+h.uncheckAllText+"</span></a></li>")}else{typeof h.header==="string"&&e.push("<li>"+h.header+"</li>")}e.push('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>');e.push("</ul>");e.push("</div>");e.push('<ul class="ui-multiselect-checkboxes ui-helper-reset">');l.find("option").each(function(p){var o=a(this),d=o.html(),c=this.value;p=this.id||"ui-multiselect-"+j+"-option-"+p;var g=o.parent(),f=o.is(":disabled"),q=["ui-corner-all"];if(g.is("optgroup")){g=g.attr("label");if(a.inArray(g,k)===-1){e.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+g+"</a></li>");k.push(g)}}if(c.length>0){f&&q.push("ui-state-disabled");e.push('<li class="'+(f?"ui-multiselect-disabled":"")+'">');e.push('<label for="'+p+'" class="'+q.join(" ")+'"><input id="'+p+'" type="'+(h.multiple?"checkbox":"radio")+'" value="'+c+'" title="'+d+'"');o.is(":selected")&&e.push(' checked="checked"');f&&e.push(' disabled="disabled"');e.push(" />"+d+"</label></li>")}});e.push("</ul></div>");this.button=l.hide().after(e.join("")).next("button");this.menu=this.button.next("div.ui-multiselect-menu");this.labels=this.menu.find("label");this.buttonlabel=this.button.find("span").eq(-1);if(!h.multiple){this.radios=this.menu.find(":radio")}this._setButtonWidth();this._setMenuWidth();this._bindEvents();this.button[0].defaultValue=this.update()},_init:function(){this.options.header||this.menu.find("div.ui-multiselect-header").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},_bindEvents:function(){function f(){e[e._isOpen?"close":"open"]();return false}var e=this,d=this.button;d.find("span").bind("click.multiselect",f);d.bind({click:f,keypress:function(c){switch(c.keyCode){case 27:case 38:case 37:e.close();break;case 39:case 40:e.open()}},mouseenter:function(){d.hasClass("ui-state-disabled")||a(this).addClass("ui-state-hover")},mouseleave:function(){a(this).removeClass("ui-state-hover")},focus:function(){d.hasClass("ui-state-disabled")||a(this).addClass("ui-state-focus")},blur:function(){a(this).removeClass("ui-state-focus")}});this.menu.find("div.ui-multiselect-header a").bind("click.multiselect",function(c){a(this).hasClass("ui-multiselect-close")?e.close():e[a(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();c.preventDefault()}).end().find("li.ui-multiselect-optgroup-label a").bind("click.multiselect",function(i){var c=a(this),h=c.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible");e._toggleChecked(h.filter(":checked").length!==h.length,h);e._trigger("optgrouptoggle",i,{inputs:h.get(),label:c.parent().text(),checked:h[0].checked});i.preventDefault()}).end().delegate("label","mouseenter",function(){if(!a(this).hasClass("ui-state-disabled")){e.labels.removeClass("ui-state-hover");a(this).addClass("ui-state-hover").find("input").focus()}}).delegate("label","keydown",function(c){switch(c.keyCode){case 9:case 27:e.close();break;case 38:case 40:case 37:case 39:e._traverse(c.keyCode,this);break;case 13:c.preventDefault();a(this).find("input").trigger("click")}}).delegate(":checkbox, :radio","click",function(i){var c=this.value,h=this.checked;if(a(this).is(":disabled")||e._trigger("click",i,{value:this.value,text:this.title,checked:h})===false){i.preventDefault()}else{e.options.multiple||e.radios.not(this).removeAttr("checked");e.element.find("option").filter(function(){return this.value===c}).attr("selected",h?"selected":"");e.update(!i.originalEvent?h?-1:1:0)}});a(document).bind("click.multiselect",function(c){c=a(c.target);e._isOpen&&!c.closest("div.ui-multiselect-menu").length&&!c.is("button.ui-multiselect")&&e.close()})},_setButtonWidth:function(){var e=this.element.outerWidth(),d=this.options;if(/\d/.test(d.minWidth)&&e<d.minWidth){e=d.minWidth}this.button.width(e)},_setMenuWidth:function(){var e=this.menu,d=this.button.outerWidth()-parseInt(e.css("padding-left"),10)-parseInt(e.css("padding-right"),10)-parseInt(e.css("border-right-width"),10)-parseInt(e.css("border-left-width"),10);e.width(d||this.button.outerWidth())},_traverse:function(h,f){var e=a(f),g=h===38||h===37?true:false;e=e.parent()[g?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[g?"last":"first"]();if(e.length){e.find("label").trigger("mouseover")}else{e=this.menu.find("ul:last");this.menu.find("label")[g?"last":"first"]().trigger("mouseover");e.scrollTop(g?e.height():0)}},_toggleChecked:function(f,e){var d=e&&e.length?e:this.labels.find("input");if(!this.options.multiple&&f){d=d.eq(0)}d.not(":disabled").attr("checked",f?"checked":"");this.update();this.element.find("option").not(":disabled").attr("selected",f?"selected":"")},_toggleDisabled:function(d){this.button.attr("disabled",d?"disabled":"")[d?"addClass":"removeClass"]("ui-state-disabled");this.menu.find("input").attr("disabled",d?"disabled":"").parent()[d?"addClass":"removeClass"]("ui-state-disabled");this.element.attr("disabled",d?"disabled":"")},update:function(){var h=this.options,f=this.labels.find("input"),e=f.filter(":checked"),g=e.length;h=g===0?h.noneSelectedText:a.isFunction(h.selectedText)?h.selectedText.call(this,g,f.length,e.get()):/\d/.test(h.selectedList)&&h.selectedList>0&&g<=h.selectedList?e.map(function(){return this.title}).get().join(", "):h.selectedText.replace("#",g).replace("#",f.length);this.buttonlabel.html(h);return h},open:function(){var n=this.button,i=this.menu,e=this.speed,m=this.options;if(!(this._trigger("beforeopen")===false||n.hasClass("ui-state-disabled")||this._isOpen)){a(":ech-multiselect").not(this.element).each(function(){var c=a(this);c.multiselect("isOpen")&&c.multiselect("close")});var k=i.find("ul:last"),l=m.show,j=n.position();if(a.isArray(m.show)){l=m.show[0];e=m.show[1]||this.speed}k.scrollTop(0).height(m.height);if(a.ui.position&&!a.isEmptyObject(m.position)){m.position.of=m.position.of||n;i.show().position(m.position).hide().show(l,e)}else{i.css({top:j.top+n.outerHeight(),left:j.left}).show(l,e)}this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");n.addClass("ui-state-active");this._isOpen=true;this._trigger("open")}},close:function(){if(this._trigger("beforeclose")!==false){var f=this.options,e=f.hide,d=this.speed;if(a.isArray(f.hide)){e=f.hide[0];d=f.hide[1]||this.speed}this.menu.hide(e,d);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._trigger("close");this._isOpen=false}},enable:function(){this._toggleDisabled(false)},disable:function(){this._toggleDisabled(true)},checkAll:function(){this._toggleChecked(true);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(false);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){a.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},_setOption:function(f,e){var d=this.menu;switch(f){case"header":d.find("div.ui-multiselect-header")[e?"show":"hide"]();break;case"checkAllText":d.find("a.ui-multiselect-all span").eq(-1).text(e);break;case"uncheckAllText":d.find("a.ui-multiselect-none span").eq(-1).text(e);break;case"height":d.find("ul:last").height(parseInt(e,10));break;case"minWidth":this.options[f]=parseInt(e,10);this._setButtonWidth();this._setMenuWidth();break;case"selectedText":case"selectedList":case"noneSelectedText":this.options[f]=e;this.update();break;case"classes":d.add(this.button).removeClass(this.options.classes).addClass(e)}a.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);